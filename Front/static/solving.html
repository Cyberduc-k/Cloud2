<!DOCTYPE html>
<html lang="en" title="Sudoku Application Cloud Computing 2">
<head>
    <title>Sudoku Application Cloud Computing 2</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css" integrity="sha384-X38yfunGUhNzHpBaEBsWLO+A0HDYOQi8ufWDkZ0k9e0eXz/tH3II7uKZ9msv++Ls" crossorigin="anonymous">
    <link rel="stylesheet" href="puzzles.css">
    <link rel="icon" href="assets/sudoku.svg" sizes="any" type="image/svg">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
</head>
<body onload="startPuzzle()">
    <main id="solving-main">
        <section class="pure-controls" id="quit-button-section">
            <button class="pure-button pure-button-primary" id="quit-button" onclick="quit()">Quit</button>
        </section>
        <section class="puzzles-window">
            <h1 class="header1-text">Solving a soduku puzzle</h1>

            <div id="timer">
                <label>Time: </label>
                <span id="hours">00:</span>
                <span id="mins">00:</span>
                <span id="seconds">00</span>  
            </div>

            <section id="solve-sudoku-section">
                <table class="sudoku-table" id="sudoku">
                    <tbody>
                        <tr>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1" name="sudoku-cell-edge"/></td>
                        </tr>
                        <tr>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1" name="sudoku-cell-edge"/></td>
                        </tr>
                        <tr>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1" name="sudoku-cell-edge"/></td>
                        </tr>
                        <tr>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1" name="sudoku-cell-edge"/></td>
                        </tr>
                        <tr>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1" name="sudoku-cell-edge"/></td>
                        </tr>
                        <tr>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1" name="sudoku-cell-edge"/></td>
                        </tr>
                        <tr>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1" name="sudoku-cell-edge"/></td>
                        </tr>
                        <tr>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1" name="sudoku-cell-edge"/></td>
                        </tr>
                        <tr>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1" name="sudoku-cell-edge"/></td>
                        </tr>
                    </tbody>
                </table>
                <button class="pure-button pure-button-primary" id="finish-button" onclick="finishPuzzle()">Finish this puzzle</button>
            </section>

            <!--<div id="controls">
                <button id="start" onclick="startTimer()">Start</button>
                <button id="stop" onclick="stopTimer()">Stop</button>
                <button id="reset" onclick="resetTimer()">Reset</button>
            </div>-->

        </section>
    </main>
    <footer class="footer-class">
        <label class="footer-team-label">Created By Cloud Computing 2 Team 3 (Elias, Fabio, Sander & Tymo) &copy; 2023 Inholland Hogeschool</label>
    </footer>
    <script>
        //JQuery select/focus the input when clicking on an input field (Quality of Life thing)
        $("input[type='text']").on("click", function() {
            $(this).select();
        });
        $("input").focus(function() {
            $(this).select();
        });
        $("input").focusin(function() {
            $(this).select();
        });

        var hours   = 0;
        var mins    = 0;
        var seconds = 0;

        function startPuzzle(){
            //call to methods to initialize the puzzle and start the timer
            initPuzzle();
            startTimer();
        }

        function initPuzzle(){

            //get the startState string of the puzzle from session storage
            startStateString = sessionStorage.getItem("PuzzleStartState");

            //remove new lines and spaces from the string
            startStateString = startStateString.replace(/\r?\n|\r|\s/g, "");

            //define all the sudoku table input fields (the amount of cells is always (without exception) equal to the length of the array below)
            sudokuCells = document.getElementsByClassName('sudoku-cell');

            //loop to set the value of the input fields in the table to the StartState values (don't set a value for an underscore (no number))
            for (var i = 0; i < startStateString.length; i++) {
                if(startStateString.charAt(i) == '_') {
                    sudokuCells[i].value = '';
                } else {
                    sudokuCells[i].value = startStateString.charAt(i);
                    sudokuCells[i].style.color = '#ec1616';
                }
            }            
        }

        function finishPuzzle(){

            //collect the input from the table and assemble these into a solutionString to send to the stopPuzzle microservice
            solutionString = "";

            sudokuCells = document.getElementsByClassName('sudoku-cell');

            for (var i = 0; i < startStateString.length; i++) {
                solutionString += sudokuCells[i].value;

                if(sudokuCells[i].name == 'sudoku-cell-edge') {
                    solutionString += '\n'
                }
                else {
                    solutionString += ' ';
                }
            }

            console.log(`your current solution:\n${solutionString}`);

            User = JSON.parse(sessionStorage.getItem("User"));
            userId = User.Id;

            let formData = new FormData();
                formData.append('Solution', solutionString);

            fetch(`/sudokus/stop`, {
                method: "POST",
                headers: {'Authorization': `${userId}`},
                body: formData
            }).then(async res => {
                try {
                    var result = await res.text();
                    if(result == "Success!") {
                        stopTimer();
                        alert(`Congratulations! You've successfully completed a puzzle!`);
                        if(confirm('Would you like to return to the puzzles page?')) {
                            window.location.replace("/puzzles.html");
                        } else {
                            alert("too bad so sad, you're going back anyway");
                            window.location.replace("/puzzles.html");
                        }
                    }
                }
                catch(error) {
                    console.log(error);
                    return;
                }
            });
        }

        function startTimer(){
            timex = setTimeout(function(){
                seconds++;
                if(seconds > 59) {
                    seconds=0;mins++;
                    if(mins>59) {
                        mins=0;hours++;
                        if(hours <10) {
                            $("#hours").text('0'+hours+':')
                        } 
                        else {
                            $("#hours").text(hours+':');
                        }
                    }
                                
                    if(mins<10) {                     
                        $("#mins").text('0'+mins+':');
                    }       
                    else {
                        $("#mins").text(mins+':');
                    }
                }    
                if(seconds <10) {
                    $("#seconds").text('0'+seconds);
                } 
                else {
                    $("#seconds").text(seconds);
                }
                
                startTimer();
            },1000);
        }

        function stopTimer(){
            clearTimeout(timex);
        }

        function resetTimer(){
            hours   = 0;
            mins    = 0;
            seconds = 0;
            document.getElementById("hours").textContent = "00:";
            document.getElementById("mins").textContent = "00:";
            document.getElementById("seconds").textContent = "00";
        }

        function quit(){
            if (confirm('Are you sure you want to quit the current sudoku puzzle?')) {
                stopTimer();
                window.location.replace("/puzzles.html");
            }
        }

    </script>
</body>
</html>