<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css" integrity="sha384-X38yfunGUhNzHpBaEBsWLO+A0HDYOQi8ufWDkZ0k9e0eXz/tH3II7uKZ9msv++Ls" crossorigin="anonymous">
    <link rel="stylesheet" href="puzzles.css">
    <link rel="icon" href="assets/sudoku.svg" sizes="any" type="image/svg">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
</head>
<body onload="startPuzzle()">
    <main id="solving-main">
        <section class="pure-controls" id="quit-button-section">
            <button class="pure-button pure-button-primary" id="quit-button" onclick="quit()">Quit</button>
        </section>
        <section class="puzzles-window">
            <h1 class="header1-text">Solving a soduku puzzle</h1>

            <div id="timer">
                <label>Time: </label>
                <span id="hours">00:</span>
                <span id="mins">00:</span>
                <span id="seconds">00</span>  
            </div>

            <section id="solve-sudoku-section">
                <table class="sudoku-table" id="sudoku">
                    <tbody>
                        <tr>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1" name="sudoku-cell-edge"/></td>
                        </tr>
                        <tr>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1" name="sudoku-cell-edge"/></td>
                        </tr>
                        <tr>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1" name="sudoku-cell-edge"/></td>
                        </tr>
                        <tr>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1" name="sudoku-cell-edge"/></td>
                        </tr>
                        <tr>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1" name="sudoku-cell-edge"/></td>
                        </tr>
                        <tr>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1" name="sudoku-cell-edge"/></td>
                        </tr>
                        <tr>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1" name="sudoku-cell-edge"/></td>
                        </tr>
                        <tr>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1" name="sudoku-cell-edge"/></td>
                        </tr>
                        <tr>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1"/></td>
                            <td><input type="text" class="sudoku-cell" maxlength="1" name="sudoku-cell-edge"/></td>
                        </tr>
                    </tbody>
                </table>
                <button class="pure-button pure-button-primary" id="finish-button" onclick="finishPuzzle()">Finish this puzzle</button>
            </section>


            <!--<div id="controls">
                <button id="start" onclick="startTimer()">Start</button>
                <button id="stop" onclick="stopTimer()">Stop</button>
                <button id="reset" onclick="resetTimer()">Reset</button>
            </div>-->

            <!-- TODO: add the session and api fetch functionalities-->

        </section>
    </main>
    <footer class="footer-class">
        <label class="footer-team-label">Created By Cloud Computing 2 Team 3 (Elias, Fabio, Sander & Tymo) &copy; 2023 Inholland Hogeschool</label>
    </footer>
    <script>
        //JQuery select the input when clicking on an input field
        $("input[type='text']").on("click", function() {
            $(this).select();
        });
        $("input").focus(function() {
            $(this).select();
        });
        $("input").focusin(function() {
            $(this).select();
        });

        var hours   = 0;
        var mins    = 0;
        var seconds = 0;

        function startPuzzle(){
            initPuzzle();
            startTimer();
        }

        function initPuzzle(){
            //startStateString = element.StartState;
            var puzzleJSON = {"StartState":"_ _ _ 9 _ _ _ _ _\n_ _ _ _ _ 6 7 _ _\n_ 8 9 1 _ _ _ 5 _\n2 _ _ _ 6 5 _ _ _\n_ _ _ _ 8 _ 2 _ 4\n_ 9 _ _ _ _ _ _ _\n4 _ _ 5 _ _ _ 7 8\n_ 6 _ _ 3 _ _ 4 _\n9 _ _ _ _ 1 _ _ 2\n","Solution":"6 4 5 9 7 8 1 2 3\n1 2 3 4 5 6 7 8 9\n7 8 9 1 2 3 4 5 6\n2 1 4 3 6 5 8 9 7\n3 5 6 7 8 9 2 1 4\n8 9 7 2 1 4 3 6 5\n4 3 1 5 9 2 6 7 8\n5 6 2 8 3 7 9 4 1\n9 7 8 6 4 1 5 3 2\n"};

            startStateString = puzzleJSON.StartState;
            //remove new lines and spaces from the string
            startStateString = startStateString.replace(/\r?\n|\r|\s/g, "");

            //define all the sudoku table input fields (the amount of cells is always (without exception) equal to the length of the array below)
            sudokuCells = document.getElementsByClassName('sudoku-cell');

            //loop to set the value of the input fields in the table to the StartState values (don't set a value for an underscore (no number))
            for (var i = 0; i < startStateString.length; i++) {
                if(startStateString.charAt(i) == '_') {
                    sudokuCells[i].value = '';
                } else {
                    sudokuCells[i].value = startStateString.charAt(i);
                    sudokuCells[i].style.color = '#ec1616';
                }
            }            
        }

        function finishPuzzle(){

            //collect the input from the table and assemble these into a solutionString to send to the stopPuzzle microservice
            solutionString = "";

            sudokuCells = document.getElementsByClassName('sudoku-cell');

            for (var i = 0; i < startStateString.length; i++) {
                solutionString += sudokuCells[i].value;

                if(sudokuCells[i].name == 'sudoku-cell-edge') {
                    solutionString += '\n'
                }
                else {
                    solutionString += ' ';
                }
            }
            console.log(`your current solution:\n${solutionString}`);

            /*var puzzleJSON = {"StartState":"_ _ _ 9 _ _ _ _ _\n_ _ _ _ _ 6 7 _ _\n_ 8 9 1 _ _ _ 5 _\n2 _ _ _ 6 5 _ _ _\n_ _ _ _ 8 _ 2 _ 4\n_ 9 _ _ _ _ _ _ _\n4 _ _ 5 _ _ _ 7 8\n_ 6 _ _ 3 _ _ 4 _\n9 _ _ _ _ 1 _ _ 2\n","Solution":"6 4 5 9 7 8 1 2 3\n1 2 3 4 5 6 7 8 9\n7 8 9 1 2 3 4 5 6\n2 1 4 3 6 5 8 9 7\n3 5 6 7 8 9 2 1 4\n8 9 7 2 1 4 3 6 5\n4 3 1 5 9 2 6 7 8\n5 6 2 8 3 7 9 4 1\n9 7 8 6 4 1 5 3 2\n"};


            if(solutionString == puzzleJSON.Solution) {
                console.log("success");
            } else {
                console.log("failure, please try again");
            }*/
            //I should have a complete solutionString right here to send with the request as the proposed solution.


            //currentSudokuId should already be set here for the user so there should be no need to send the sodukuId as well here right?
            let data = { Solution: solutionString };

            //fetch/call to the stop sudoku puzzle microservice with the solution

            fetch(`/sudokus/stop`, {
                method: "POST",
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            }).then(res => {

                if(JSON.parse(res.data) == "Success!") {

                    stopTimer();
                    alert(`Congratulations! You've successfully completed a puzzle!`);
                    if(confirm('Would you like to return to the puzzles page?')) {
                        window.location.replace("/puzzles.html");
                    }
                }
            });
        }

        function startTimer(){
            timex = setTimeout(function(){
                seconds++;
                if(seconds > 59) {
                    seconds=0;mins++;
                    if(mins>59) {
                        mins=0;hours++;
                        if(hours <10) {
                            $("#hours").text('0'+hours+':')
                        } 
                        else {
                            $("#hours").text(hours+':');
                        }
                    }
                                
                    if(mins<10) {                     
                        $("#mins").text('0'+mins+':');
                    }       
                    else {
                        $("#mins").text(mins+':');
                    }
                }    
                if(seconds <10) {
                    $("#seconds").text('0'+seconds);
                } 
                else {
                    $("#seconds").text(seconds);
                }
                
                startTimer();
            },1000);
        }

        function stopTimer(){
            clearTimeout(timex);
        }

        function resetTimer(){
            hours   = 0;
            mins    = 0;
            seconds = 0;
            document.getElementById("hours").textContent = "00:";
            document.getElementById("mins").textContent = "00:";
            document.getElementById("seconds").textContent = "00";
        }

        function quit(){
            if (confirm('Are you sure you want to quit the current sudoku puzzle?')) {
                stopTimer();
                window.location.replace("/puzzles.html");
            }
        }

    </script>
</body>
</html>